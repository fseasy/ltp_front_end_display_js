a transplantation from flash to js
